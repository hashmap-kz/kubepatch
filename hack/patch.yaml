- target:
    kind: Deployment
    name: myapp
  patches:
    - op: add
      path: /spec/template/spec/containers/0/env
      value:
        - name: ENV
          value: production
        - name: LOG_LEVEL
          value: debug

    - op: add
      path: /spec/template/spec/containers/0/ports
      value:
        - containerPort: 8080
          name: http
          protocol: TCP

    - op: add
      path: /spec/template/spec/containers/0/volumeMounts
      value:
        - name: config
          mountPath: /etc/config

    - op: add
      path: /spec/template/spec/containers/0/resources
      value:
        limits:
          cpu: "500m"
          memory: "256Mi"
        requests:
          cpu: "250m"
          memory: "128Mi"

    - op: add
      path: /spec/template/spec/affinity
      value:
        podAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: role
                    operator: In
                    values:
                      - primary
              topologyKey: kubernetes.io/hostname